<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Minecraft Skin Pack Maker</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    /* ====== THEME COLORS (same as mywebpro.html) ====== */
    * {
        box-sizing: border-box;
    }
    body {
      --color-bg-primary: #FFFFFF;
      --color-bg-secondary: #F9FAFB;
      --color-text-primary: #111827;
      --color-text-secondary: #6B7280;
      --color-primary: #4F46E5;
      --color-border: #E5E7EB;
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    body[data-theme="dark"] {
      --color-bg-primary: #0A0A0A;
      --color-bg-secondary: rgba(24, 24, 27, 0.95);
      --color-text-primary: #F3F4F6;
      --color-text-secondary: #9CA3AF;
      --color-primary: #6366F1;
      --color-border: rgba(75, 85, 99, 0.5);
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
    }

    /* ====== HEADER ====== */
    header {
      /* **CHANGED to sticky and top: 0** */
      position: sticky; 
      top: 0; 
      z-index: 1000; /* Ensures the header stays on top */
      /* --- */
      background: var(--color-bg-secondary);
      border-bottom: 1px solid var(--color-border);
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header-title {
      color: var(--color-primary);
      font-weight: 700;
      font-size: 20px;
    }
    .back-btn {
      background: var(--color-primary);
      color: #fff;
      text-decoration: none;
      padding: 8px 15px;
      border-radius: 6px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 5px;
      transition: 0.2s;
    }
    .back-btn:hover { opacity: 0.85; }

    /* ====== MAIN ====== */
    main {
      flex: 1;
      display: flex;
      justify-content: center;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 600px;
      background: var(--color-bg-secondary);
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 0 20px rgba(0,0,0,0.3);
    }
    input, textarea, select, button {
       max-width: 100%;
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--color-text-primary);
    }

    /* ====== INPUTS & BUTTONS ====== */
    .preview {
      width: 128px;
      height: 128px;
      background: #333;
      margin: 10px auto;
      background-size: cover;
      background-position: center;
      border: 2px solid var(--color-border);
      border-radius: 8px;
    }
    input[type="file"], input[type="text"], button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: none;
      font-size: 15px;
    }
    input[type="file"], input[type="text"] {
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      border: 1px solid var(--color-border);
    }

    /* ====== CUSTOM FILE BUTTON ====== */
    .custom-file-upload {
      background: var(--color-bg-primary);
      color: var(--color-text-primary);
      display: block;
      text-align: center;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 15px;
      border: 1px solid var(--color-border);
      transition: background 0.3s;
    }
    .custom-file-upload:hover {
      background: var(--color-border);
    }
    input[type="file"] { display: none !important; }

    button {
      background: var(--color-primary);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    button:hover { opacity: 0.9; }

    /* ====== SKIN BLOCKS ====== */
    .skin-block {
      background: var(--color-bg-primary);
      border: 1px solid var(--color-border);
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .icon { margin-right: 8px; }

    /* ====== LOCKED DISPLAY ====== */
    .skin-name-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--color-bg-secondary);
      color: var(--color-text-primary);
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid var(--color-border);
      font-size: 15px;
    }
    .skin-name-text {
      flex-grow: 1;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    .edit-icon {
      cursor: pointer;
      color: var(--color-primary);
      margin-left: 10px;
      font-size: 1.1em;
    }
    .hidden { display: none !important; }

    /* ====== FOOTER ====== */
    footer {
      background: var(--color-bg-secondary);
      border-top: 1px solid var(--color-border);
      padding: 12px;
      text-align: center;
      font-size: 12px;
      color: var(--color-text-secondary);
    }
  </style>
</head>
<body>
  <header id="header-title">
    <div class="header-title">Skin Pack Maker</div>
    <a href="https://meow-me7.github.io/myweb/mywebpro.html" class="back-btn">
      Back
    </a>
  </header>

  <main>
    <div class="container">
      <h2><i class="fas fa-cube icon"></i> Minecraft Skin Pack Maker</h2>
      <input type="text" id="packName" placeholder="Enter Skin Pack Name (e.g. My Skin Pack)">
      <div id="skinsContainer"></div>
      <button onclick="addSkinInput()"><i class="fas fa-plus icon"></i> Add Another Skin</button>
      <button onclick="downloadSkinPack()"><i class="fas fa-download icon"></i> Download Skin Pack</button>
    </div>
  </main>

  <footer>&copy; 2025 Ideas Now Alive. All rights reserved.</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
<script>
  // =======================================================
  // ðŸ”’ SECURITY BLOCK: Disable Right-Click and Console Shortcuts (Original)
  // =======================================================

  document.addEventListener('contextmenu', event => event.preventDefault());

  document.addEventListener('keydown', function(event) {
    if (event.key === 'F12') {
      event.preventDefault();
    }
    if ((event.ctrlKey || event.metaKey) && event.shiftKey && 
        (event.key === 'I' || event.key === 'J' || event.key === 'K')) {
      event.preventDefault();
    }
    if ((event.ctrlKey || event.metaKey) && event.key === 'U') {
      event.preventDefault();
    }
  });

  // =======================================================
  // END SECURITY BLOCK
  // =======================================================

  const skinsContainer = document.getElementById('skinsContainer');

  function updateSkinBlockToDisplay(block, name) {
    const inputFile = block.querySelector('input[type="file"]');
    const inputName = block.querySelector('input[type="text"]');
    const customButton = block.querySelector('.custom-file-upload');
    let displayDiv = block.querySelector('.skin-name-display');

    if (!displayDiv) {
        displayDiv = document.createElement('div');
        displayDiv.classList.add('skin-name-display');

        const nameSpan = document.createElement('span');
        nameSpan.classList.add('skin-name-text');
        nameSpan.textContent = name;

        const editIcon = document.createElement('i');
        editIcon.classList.add('fas', 'fa-pencil-alt', 'edit-icon');
        editIcon.title = "Change Skin Name";
        editIcon.onclick = (e) => editSkinName(e, block);

        displayDiv.appendChild(nameSpan);
        displayDiv.appendChild(editIcon);

        block.insertBefore(displayDiv, inputName);
    } else {
        displayDiv.querySelector('.skin-name-text').textContent = name;
        displayDiv.classList.remove('hidden');
    }

    inputName.classList.add('hidden');
    inputName.value = name;
    
    if (customButton) {
        customButton.classList.add('hidden');
    }
  }

  function editSkinName(event, block) {
    const nameSpan = block.querySelector('.skin-name-text');
    const inputName = block.querySelector('input[type="text"]');
    
    let currentName = nameSpan.textContent;
    const newName = prompt("Enter the new skin name:", currentName);

    if (newName !== null && newName.trim() !== "") {
      nameSpan.textContent = newName.trim();
      inputName.value = newName.trim();
    }
  }


  function createSkinBlock() {
    const block = document.createElement('div');
    block.classList.add('skin-block');

    const inputFile = document.createElement('input');
    inputFile.type = 'file';
    inputFile.accept = 'image/png';
    const uniqueId = 'file-' + Date.now() + Math.random().toString(36).substring(2, 9);
    inputFile.id = uniqueId;

    const customButton = document.createElement('label');
    customButton.htmlFor = uniqueId;
    customButton.classList.add('custom-file-upload');
    customButton.innerHTML = '<i class="fas fa-file-image icon"></i> Select Skin Image';
    
    const preview = document.createElement('div');
    preview.classList.add('preview');

    const inputName = document.createElement('input');
    inputName.type = 'text';
    inputName.placeholder = 'Enter Skin Name';

    inputFile.addEventListener('change', function () {
      const file = inputFile.files[0];
      if (file && file.type === 'image/png') {
        customButton.innerHTML = `<i class="fas fa-check icon"></i> ${file.name}`;
        
        const reader = new FileReader();
        reader.onload = function (e) {
          preview.style.backgroundImage = `url(${e.target.result})`;
        };
        reader.readAsDataURL(file);
      }
    });

    block.appendChild(inputFile);
    block.appendChild(customButton);
    block.appendChild(preview);
    block.appendChild(inputName);
    skinsContainer.appendChild(block);

    return block; 
  }

  createSkinBlock();

  function addSkinInput() {
    const lastBlock = skinsContainer.lastElementChild;
    
    if (lastBlock) {
      const inputName = lastBlock.querySelector('input[type="text"]');
      const lastName = inputName.value.trim();
      const lastFile = lastBlock.querySelector('input[type="file"]').files[0];
      
      if (!lastName && !lastFile) {
        lastBlock.remove();
      } 
      else if (!lastName || !lastFile) {
        alert("Please enter a name and select a file for the previous skin before adding another.");
        return; 
      }
      else {
        updateSkinBlockToDisplay(lastBlock, lastName);
      }
    }
    
    const newBlock = createSkinBlock();
    newBlock.scrollIntoView({ behavior: "smooth", block: "center" });
  }

  

  function generateUUID() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r & 0x3 | 0x8);
      return v.toString(16);
    });
  }

  function downloadSkinPack() {
    const packName = document.getElementById('packName').value.trim() || 'My Skin Pack';
    const blocks = document.querySelectorAll('.skin-block');
    const zip = new JSZip();
    const skinFolder = zip.folder(packName);
    const skinJson = [];
    let pending = blocks.length;
    let hasError = false;

    if (pending === 0) {
      alert('Add at least one skin first.');
      return;
    }

    const lastBlock = skinsContainer.lastElementChild;
    if (lastBlock) {
      const inputName = lastBlock.querySelector('input[type="text"]');
      const lastName = inputName.value.trim();
      const lastFile = lastBlock.querySelector('input[type="file"]').files[0];
      
      if (!lastName && !lastFile && !lastBlock.querySelector('.skin-name-display')) {
        pending--;
      }
      else if (!lastName || !lastFile) {
        alert("The last skin is incomplete. Please fill the name and select a file.");
        return;
      }
    }
    
    if (pending === 0) {
        alert('Add at least one skin first.');
        return;
    }


    blocks.forEach((block, index) => {
      
      const inputName = block.querySelector('input[type="text"]'); 
      const lastName = inputName.value.trim();
      const lastFile = block.querySelector('input[type="file"]').files[0];
      
      if (!lastName && !lastFile && !block.querySelector('.skin-name-display')) {
        return;
      }
      
      if(hasError) return; 

      const inputFile = block.querySelector('input[type="file"]');
      const file = inputFile.files[0];
      const name = lastName;

      if (!file || !name) {
        alert(`Skin ${index + 1} is missing name or file.`);
        hasError = true;
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        if(hasError) return; 
        
        skinFolder.file(`${name}.png`, e.target.result);
        
        const safeSkinName = name.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();
        
        skinJson.push({
          localization_name: safeSkinName,
          display_name: name,
          geometry: "geometry.humanoid.custom",
          texture: `${name}.png`,
          type: "free"
        });

        pending--;
        if (pending === 0) finalize();
      };
      reader.readAsArrayBuffer(file);
    });
    
    if (hasError) return; 

    function finalize() {
      const uuid1 = generateUUID();
      const uuid2 = generateUUID();

      const safePackName = packName.replace(/[^a-zA-Z0-9]/g, '_').toLowerCase();
      let langContent = `skinpack.${safePackName}=${packName}\n`;
      const cleanedSkinJson = [];
      
      skinJson.forEach(skin => {
        langContent += `skin.${safePackName}.${skin.localization_name}=${skin.display_name}\n`;

        const { display_name, ...cleanedSkin } = skin;
        cleanedSkinJson.push(cleanedSkin);
      });


      const manifest = {
        format_version: 2,
        header: {
          name: packName,
          uuid: uuid1,
          version: [1, 0, 0]
        },
        modules: [
          {
            type: "skin_pack",
            uuid: uuid2,
            version: [1, 0, 0]
          }
        ]
      };

      const skins = {
        format_version: 1,
        skins: cleanedSkinJson,
        serialize_name: safePackName,
        localization_name: safePackName
      };

      skinFolder.file("manifest.json", JSON.stringify(manifest, null, 2));
      skinFolder.file("skins.json", JSON.stringify(skins, null, 2));
      
      skinFolder.folder("texts").file("en_US.lang", langContent); 

      zip.generateAsync({ type: "blob" }).then(function (content) {
        const fileName = `${packName.replace(/\s+/g, '_').toLowerCase()}.mcpack`;
        const mcpackBlob = new Blob([content], { type: 'application/octet-stream' }); 
        
        const a = document.createElement('a');
        a.href = URL.createObjectURL(mcpackBlob);
        a.download = fileName; 
        
        a.click();
        URL.revokeObjectURL(a.href);
      });
    }
  }


    (()=>{
    const prefersDark=window.matchMedia('(prefers-color-scheme: dark)').matches;
    if(prefersDark)document.body.setAttribute('data-theme','dark');
  })();
</script>
</body>
</html>
